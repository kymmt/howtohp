<!DOCTYPE html><html><head><meta charset=utf-8><title>howtohp</title><meta name=viewport content="width=device-width"><meta name=description content=""><!-- Twitter --><meta name=twitter:card content=summary><meta name=twitter:author content=@howtohp><meta name=twitter:title content=howtohp><meta name=twitter:description content=""><!-- Facebook --><meta property=og:type content=article><meta property=og:title content=howtohp><meta property=og:description content=""><meta property=og:url content="http:howtohp.com/"><meta property=og:locale content=ja-JP><meta property=article:published_time content=""><link rel=stylesheet href=/css/main.50c7.css><link rel=stylesheet href=/css/main.50c7.css></head><body><header class="header container" role=banner><div class=header__title><h1><a href="/">howtohp</a></h1></div><nav class=global-nav role=navigation><ul class=global-nav__list><li class=global-nav__item><a class=global-nav__link href="/">HOME</a></li><li class=global-nav__item><a class=global-nav__link href=/archive>Archive</a></li><li class=global-nav__item><a class=global-nav__link href=/about>About</a></li></ul></nav></header><div class="main container--small" role=main><article class="entry h-entry" itemscope itemtype=http://schema.org/BlogPosting itemprop=blogPost><header class=entry__header><h1 class=entry__title>ブログをWordpressからJykellに、サーバーをさくらからgithubへ</h1><div class=entry__meta><time class=entry__published itemprop=datePublished datetime="15 Apr 2014"><span class=icon-calendar></span> <span class=entry__published__day>15</span> <span class=entry__published__month>Apr</span> <span class=entry__published__year>2014</span></time><div class=entry__tags><span class=icon-tags></span><ul class=entry__tags__list><li class=entry__tags__item itemprop=keywords>Jykell</li><li class=entry__tags__item itemprop=keywords>Grunt</li><li class=entry__tags__item itemprop=keywords>Github</li></ul></div></div><!-- / .entry__meta --></header><div class=entry__content itemprop=articleBody><section><h1 id=wordpressjykell>ブログをWordpressからJykellに</h1><p>rcmdnk/vim-markdown ブログをWordpressからJykellに変更した。<br>主な理由は下記の通り。</p><ul><li>マークダウン記法で記事が書きたかった。</li><li>普段使ってるエディタ(Vim)で記事が書きたかった。</li><li>現状アクセス頂いているユーザーの動向から、直接記事にアクセスして直帰していく人がメインなので、メインユーザー向けに構成を合わせたかった。(Jykellあんま関係ない)</li><li>サーバーをgithubに移行して、サーバー代を浮かせたかった。(ここ重要)</li></ul><p>最初は<a href="http://middlemanapp.com/">middleman</a>を使おうと思ってたんだけど、Compassのアルファ版が使えなかったのでやめた。<br>middlemanにはCompassが組み込まれていて、色々読んでいるとアルファ版はサポートしないポリシーらしい。そらそうですよね。</p><p>Prefix周りに関しては、Gruntを使ってるので<a href=https://github.com/nDmitry/grunt-autoprefixer>grunt-autoprefixer</a>に任せて、Compassの機能として画像のData&nbsp;<span class=caps>URI</span>化、スプライト化に関してのみなんとかできればCompassもういいかなと思いはじめてる。</p><h2 id=section>用意するもの</h2><ul><li>Ruby&nbsp;<span class=caps>1.9</span>+<ul><li>Bundler</li><li>jekyll-import</li></ul></li><li>node.js<ul><li>yeoman</li><li>Grunt</li><li>generator-jekyllrb</li></ul></li></ul><h2 id=yeomanjykellrbgrunt>YeomanのjykellrbジェネレーターでさくっとGruntの準備</h2><p>jykell-importとgenerator-jekyllrb以外は元々入っていたので、足りない2つをインストール。</p><div class=highlight><pre><code class=bash>gem install jekyll-import
sudo npm install -g generator-jekyllrb</code></pre></div><p>必要なものが揃ったら、Yeomanのジェネレーターで初期ファイルの生成</p><div class=highlight><pre><code class=bash>yo jekyllrb</code></pre></div><p>生成したファイル内にBundler用の<code>Gemfile</code>があるので、そこに使いたいGemを書いておく。&nbsp;とりあえずマークダウンのGemがデフォルトでMarukuが使われているのでkramdownにした。</p><h3 id=gemfilekramdown>Gemfileにkramdownを追記</h3><div class=highlight><pre><code class=ruby><span class=n>gem</span> <span class=s1>&#39;kramdown&#39;</span></code></pre></div><h3 id=configyml>_config.ymlの設定</h3><p>マークダウンライブラリの指定と、SyntaxHighlightも使いたいのでpygmentsもtrueに</p><div class=highlight><pre><code class=yaml><span class=l-Scalar-Plain>markdown</span><span class=p-Indicator>:</span> <span class=l-Scalar-Plain>kramdown</span>
<span class=l-Scalar-Plain>pygments</span><span class=p-Indicator>:</span> <span class=l-Scalar-Plain>true</span></code></pre></div><p>pygmentsはPythonのライブラリなのでPythonが動く必要がある。</p><p>またkramdownのマークダウンライブラリが残念ながらPygmentsに対応していなかったので、プラグインで対応。<br>次のバージョンのJekyllはデフォルトでKramdownになるらしいがPygmentsの対応はどうなるんだろう。Pygmentsやめるのかな。</p><h3 id=krampygs>Krampygsプラグインの導入</h3><p>こまかい導入方法はここの<a href="http://jekyllrb.com/docs/plugins/">Jekyll Plugins</a>のページと、<a href=https://github.com/navarroj/krampygs>krampygs</a>のプラグインのページを参考にするとして、krampygsがTypogrubyというGemに依存しているので、Gemfileに<code>gem 'typogruby'</code>とかいておく。</p><p>これでシンタックスハイライトの際に、そこだけLiquidタグで<code>{% highlight 言語名 %}</code>とか書かなくても、<code>~~~</code>でくくればコードブロックとして変換してくれるようになる。</p><h4 id=vim>Vimのマークダウンプラグインを変更</h4><p>こちらの、<a href="http://rcmdnk.github.io/blog/2013/11/17/computer-vim/">VimでのMarkdown環境を整える</a>を参考に、<a href=https://github.com/rcmdnk/vim-markdown>rcmdnk/vim-markdown</a>導入させてもらった。<br>元々は、<a href=tpope/vim-markdown>tpope/vim-markdown</a>を使ってたのだけど、最近のVimだと元々入ってるみたい。</p><h3 id=compass-100alpha>Compass&nbsp;<span class=caps>1.0.0</span>.alphaを使うための設定</h3><p>アルファ版を使う必要がなければここは変更する必要がない。 <code>Gemfile</code>にgem ‘compass’, ‘~&gt; <span class=caps>1.0.0</span>.alpha.19’と書くと<code>bundle install</code>した際にlistenのバージョンがJykellと違ってインストール出来ない。<br>CompassはグローバルにインストールされているCompass&nbsp;<span class=caps>1.0.0.19</span>を利用したかったので、<code>Gruntfile.js</code>のCompassの設定をちょい変更</p><div class=highlight><pre><code class=js><span class=nx>compass</span><span class=o>:</span> <span class=p>{</span>
  <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
    <span class=c1>// If you&#39;re using global Sass gems, require them here.</span>
    <span class=nx>require</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;singularity&#39;</span><span class=p>,</span> <span class=s1>&#39;jacket&#39;</span><span class=p>],</span>  <span class=c1>//コメントアウトをはずす</span>
    <span class=c1>//bundleExec: true,                  //コメントアウト</span>
    <span class=nx>sassDir</span><span class=o>:</span> <span class=s1>&#39;&lt;%= yeoman.app %&gt;/_scss&#39;</span><span class=p>,</span>
    <span class=nx>cssDir</span><span class=o>:</span> <span class=s1>&#39;.tmp/css&#39;</span><span class=p>,</span>
    <span class=nx>imagesDir</span><span class=o>:</span> <span class=s1>&#39;&lt;%= yeoman.app %&gt;/img&#39;</span><span class=p>,</span>
    <span class=nx>javascriptsDir</span><span class=o>:</span> <span class=s1>&#39;&lt;%= yeoman.app %&gt;/js&#39;</span><span class=p>,</span>
    <span class=nx>relativeAssets</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
    <span class=nx>httpImagesPath</span><span class=o>:</span> <span class=s1>&#39;/img&#39;</span><span class=p>,</span>
    <span class=nx>httpGeneratedImagesPath</span><span class=o>:</span> <span class=s1>&#39;/img/generated&#39;</span><span class=p>,</span>
    <span class=nx>outputStyle</span><span class=o>:</span> <span class=s1>&#39;expanded&#39;</span><span class=p>,</span>
    <span class=nx>raw</span><span class=o>:</span> <span class=s1>&#39;extensions_dir = &quot;&lt;%= yeoman.app %&gt;/_bower_components&quot;\n&#39;</span>
  <span class=p>},</span>
  <span class=p>...</span></code></pre></div><p>コメントでsingularityとjacketが必要って書いてあるので、それらをインストールしておく。<br>これらのgemはグローバルでインストールしておくので、<code>Gemfile</code>にはかかない。</p><div class=highlight><pre><code class=bash>gem install singularity
gem install jacket</code></pre></div><h2 id=wordpressjykell-1>WordpressからJykellへデータ移行</h2><p>Wordpressのデータを移行するのは、jekyll-importを使った。</p><div class=highlight><pre><code class=bash>ruby -rubygems -e <span class=s1>&#39;require &quot;jekyll-import&quot;;</span>
<span class=s1>JekyllImport::Importers::WordpressDotCom.run({</span>
<span class=s1>    &quot;source&quot; =&gt; &quot;wordpress.xml&quot;</span>
<span class=s1>})&#39;</span></code></pre></div><p><code>"wordpress.xml"</code>の所をエクスポートしたファイル名にすればいい。<br>Wordpressのアイキャッチ画像は上手く移行できなかったので、そこはレイアウトを変えたのでサイズ的にもバランスが悪くなったので、一旦やめた。</p><p>はてブとか、Feedlyとかそういうのでアイキャッチ画像出してくれるので、あった方がいいとは思っているがこれは後で考える。</p><h2 id=jykellrelatedpost>Jykellの関連記事(related_post)について</h2><p>Jykellには<code>site.related_posts</code>というのが使えて、関連リンクを表示できるのかと思いきや、最新の記事が入っていただけだった。<br>公式ドキュメントにはこうかかれている。</p><blockquote><p>If the page being processed is a Post, this contains a list of up to ten related&nbsp;Posts. By default, these are low quality but fast to&nbsp;compute. For high quality but slow to compute results, run the jekyll command with the –lsi (latent semantic indexing)&nbsp;option.</p></blockquote><p>low&nbsp;qualityじゃなくてちゃんと、最新の記事が10件入ってるって書いて欲しい所。</p><p>ちゃんとした関連記事を表示させるには、jekyllコマンドを実行する際に–lsiオプションを付けるか、<code>_config.yml</code>にlsi:&nbsp;trueとする必要がある。</p><p>ただ、単純に、このオプションを有効にしてビルドすると、激重になる。<br>自分の場合10分たっても終わらなかった。</p><p>これを改善するには、<span class=caps>GSL</span>（<span class=caps>GNU</span> Scientific&nbsp;Library）とそれをrubyで使うためのrb-gslが必要です。</p><h3 id=homebrewgsl>Homebrewで<span class=caps>GSL</span>をインストール</h3><div class=highlight><pre><code class=bash>brew install gsl</code></pre></div><p>インストールすると、gsl&nbsp;<span class=caps>1.16</span>がインストールされた。</p><h3 id=gemfilerb-gsl>Gemfileにrb-gslを追記</h3><p>gemには単純にgslというのもあったんだけど、それだと<span class=caps>GSL</span>の<span class=caps>1.16</span>に対応してなかったっぽい。<br>探したら、rb-gslという<span class=caps>1.16</span>に対応したフォーク版を使う。</p><div class=highlight><pre><code class=ruby><span class=n>gem</span> <span class=s1>&#39;rb-gsl&#39;</span><span class=p>,</span> <span class=s1>&#39;~&gt; 1.16.0&#39;</span></code></pre></div><h2 id=gem>Gemをインストールしておく。</h2><p>最終的には<code>Gemfile</code>はこんな感じ</p><div class=highlight><pre><code class=ruby><span class=n>source</span> <span class=s2>&quot;http://rubygems.org&quot;</span>

<span class=n>gem</span> <span class=s1>&#39;jekyll&#39;</span><span class=p>,</span> <span class=s1>&#39;~&gt;1.4.0&#39;</span>

<span class=c1>#markdown</span>
<span class=n>gem</span> <span class=s1>&#39;kramdown&#39;</span>
<span class=n>gem</span> <span class=s1>&#39;typogruby&#39;</span>

<span class=c1>#for related post</span>
<span class=n>gem</span> <span class=s1>&#39;rb-gsl&#39;</span><span class=p>,</span> <span class=s1>&#39;~&gt; 1.16.0&#39;</span></code></pre></div><p><code>bundle</code>のコマンドでインストール</p><div class=highlight><pre><code class=bash>bundle install --path ./vendor/bundle</code></pre></div><p>これで、<code>vendor/bundle</code>にインストールされ、.bundle/configにオプションの設定ファイルが作成される。</p></section><section><h1 id=github>サーバーをさくらからgithubへ</h1></section></div></article><hr><section class=entries><h1 class=entries__title>Recent Posts</h1><ul class=entries__list><li class=entries__item><a class=entries__link href="/jekyll/update/2014/04/05/welcome-to-jekyll/" rel=bookmark title="Welcome to Jekyll!">Welcome to Jekyll!</a> <time class=entries__published published="" itemprop=datePublished datetime="05 Apr 2014">5 Apr 2014</time></li><li class=entries__item><a class=entries__link href="/2013/12/27/sass-bem/" rel=bookmark title=SASSを使ってBEMで記述>SASSを使ってBEMで記述</a> <time class=entries__published published="" itemprop=datePublished datetime="27 Dec 2013">27 Dec 2013</time></li><li class=entries__item><a class=entries__link href="/tools/2013/04/24/useful-command-line/" rel=bookmark title=Macユーザーなら覚えといた方がいいTerminalの便利なコマンド>Macユーザーなら覚えといた方がいいTerminalの便利なコマンド</a> <time class=entries__published published="" itemprop=datePublished datetime="24 Apr 2013">24 Apr 2013</time></li><li class=entries__item><a class=entries__link href="/css/2013/04/18/prevent_skype/" rel=bookmark title=Skypeのブラウザ拡張を入れてる人が番号をスタイリングしちゃうのを防ぐ方法>Skypeのブラウザ拡張を入れてる人が番号をスタイリングしちゃうのを防ぐ方法</a> <time class=entries__published published="" itemprop=datePublished datetime="18 Apr 2013">18 Apr 2013</time></li></ul></section><!-- / .entries --></div><!-- / .main --><div class="footer-container container"><footer class=footer role=contentinfo><div class=social-rss><ul class=social-rss__list><li class=social-rss__item><a href=http://twitter.com/#!/howtohp id=twitter title=Twitter>Twitter</a></li><li class=social-rss__item><a href=http://www.facebook.com/howtohp id=facebook-page title="Facebook Page">Facebook Page</a></li><li class=social-rss__item><a href=http://feeds.feedburner.com/howtohp/ZiSA id=feed title=Feed>feed</a></li></ul></div><p><small class=copy>&#9786;&nbsp;howtohp</small> Powered by <a href="http://jekyllrb.com/">Jekyll</a></p></footer></div><!-- / #footer-container --><script src=/js/scripts.d5d1.js></script></body></html>