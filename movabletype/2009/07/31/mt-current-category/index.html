<!DOCTYPE html><html><head><meta charset=utf-8><title>MTでカテゴリーナビの所属しているカテゴリのみ条件分岐する</title><meta name=viewport content="width=device-width"><meta name=description content=""><!-- Twitter --><meta name=twitter:card content=summary><meta name=twitter:author content=@howtohp><meta name=twitter:title content=MTでカテゴリーナビの所属しているカテゴリのみ条件分岐する><meta name=twitter:description content=""><!-- Facebook --><meta property=og:type content=article><meta property=og:title content=MTでカテゴリーナビの所属しているカテゴリのみ条件分岐する><meta property=og:description content=""><meta property=og:url content="http:howtohp.com/movabletype/2009/07/31/mt-current-category/"><meta property=og:locale content=ja-JP><meta property=article:published_time content="2009-07-31 00:00:00 +0900"><!-- build:css({app,.tmp}) /css/main.css --><!-- Syntax highlighting CSS --><link rel=stylesheet href=/css/syntax.css><!-- Custom CSS --><link rel=stylesheet href=/css/style.css><!-- endbuild --><!-- build:css({app,.tmp}) /css/main.css --><!-- Syntax highlighting CSS --><link rel=stylesheet href=/css/syntax.css><!-- Custom CSS --><link rel=stylesheet href=/css/style.css><!-- endbuild --></head><body><header class="header container" role=banner><div class=header__title><h1><a href="/">howtohp</a></h1></div><nav class=global-nav role=navigation><ul class=global-nav__list><li class=global-nav__item><a class=global-nav__link href="/">HOME</a></li><li class=global-nav__item><a class=global-nav__link href=/archive>Archive</a></li><li class=global-nav__item><a class=global-nav__link href=/about>About</a></li></ul></nav></header><div class="main container--small" role=main><article class="entry h-entry" itemscope itemtype=http://schema.org/BlogPosting><header class=entry__header><h1 class=entry__title itemprop=name>MTでカテゴリーナビの所属しているカテゴリのみ条件分岐する</h1><div class=entry__meta><time class=entry__published itemprop=datePublished datetime="31 Jul 2009"><span class=icon-calendar></span> 31 Jul, 2009</time><div class=entry__tags><span class=icon-tags></span><ul class=entry__tags__list><li class=entry__tags__item itemprop=keywords>MovableType</li></ul></div></div><!-- / .entry__meta --></header><div class=entry__content itemprop=articleBody><p>Movable Type(以下MT）でブログなどのウェブサイトを制作していると、ユーザビリティを上げるため、ナビゲーションの現在いるページの部分をハイライトさせて表示させるデザインにすることが多くあると思います。</p><p>しかし、<abbr title="Movable Type">MT</abbr>を使用してカテゴリー一覧を表示させると、その中の一部に対して、特別なidを付けるのは普通の<abbr title="Movable Type">MT</abbr>タグだけでは、難しかったのですが、最近、やっと方法がわかったので、メモしておきます。</p><p><!--more--></p><h1>一階層目までのカテゴリーリストを表示する場合</h1><p>まず、現在の開いているページのカテゴリーを取得するのですが、ここでMTSetVarBlockタグを使い、変数として、用意しておきます。</p><p>このサイトの場合は、変数を用意する場合、すべて一ヶ所にまとめていた方が分かりやすいので、ヘッダーテンプレートのDTDより前にまとめて記述します。</p><p>以下がソースです。</p><pre data-language=html><code>&lt;mt:IfArchiveType archive_type="Individual"&gt;
&lt;MTSetVarBlock name="category_label"&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTSetVarBlock&gt;
&lt;/mt:IfArchiveType&gt;
&lt;mt:IfArchiveType archive_type="Category"&gt;
&lt;MTSetVarBlock name="category_label"&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTSetVarBlock&gt;
&lt;/mt:IfArchiveType&gt;</code></pre><p>ここでは、mt:IfArchiveType を使用して、個別ページと、カテゴリーアーカイブページで変数を利用するように条件分岐しています。<br>ここで、分岐しておかないと、すべてのテンプレートに挿入される場合、カテゴリーが存在しないトップページなどで利用できないので、再構築の際にエラーがでます。</p><p>個別ページとカテゴリーページのテンプレートに挿入すれば、分岐しなくても問題ないような気もしますが、未確認ですので、どなたか確認された方は報告頂ければありがたいです。</p><p>次に、本題のカテゴリーナビの部分ですが、MTTopLevelCategoriesかMTSubCategoriesを使用して一覧を表示していると思うのですが、その中で、もう一度、現在表示しているページのカテゴリーを変数として定義し、カテゴリー一覧を表示している中で現在表示しているカテゴリーと一致するものだけ分岐します。</p><p>以下がulで一覧を括った場合のソースです。</p><pre data-language=html><code>&lt;ul&gt;
&lt;MTTopLevelCategories&gt;
&lt;MTSetVarBlock name="category_label2"&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTSetVarBlock&gt;
&lt;MTIf name="category_label2" eq="$category_label"&gt;
&lt;li id="current"&gt;&lt;a href="&lt;$MTCategoryArchiveLink$&gt;"&lt;MTIfNonEmpty tag="MTCategoryDescription"&gt; title="&lt;$MTCategoryDescription$&gt;"&lt;/MTIfNonEmpty&gt;&gt;&lt;$MTCategoryLabel$&gt;&lt;/a&gt;&lt;/li&gt;
&lt;MTElse&gt;
&lt;li&gt;&lt;a href="&lt;$MTCategoryArchiveLink$&gt;"&lt;MTIfNonEmpty tag="MTCategoryDescription"&gt; title="&lt;$MTCategoryDescription$&gt;"&lt;/MTIfNonEmpty&gt;&gt;&lt;$MTCategoryLabel$&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/MTElse&gt;
&lt;/MTIf&gt;
&lt;/MTTopLevelCategories&gt;
&lt;/ul&gt;</code></pre><p>上記では、トップレベルのカテゴリーのみを分岐して、表示しているカテゴリーのliタグにid="current"を付けている例です。</p><h1>二階層目までのカテゴリーリストを表示する場合</h1><p>最近、仕事で、二階層目までのサブカテゴリーをハイライトし、所属している親カテゴリーにも別のidを付けてハイライトする必要があったので、以下にソースを晒しておきます。</p><p>まずは、変数宣言部分のソース</p><pre data-language=html><code>&lt;mt:IfArchiveType archive_type="Individual"&gt;
&lt;MTSetVarBlock name="category_label"&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTSetVarBlock&gt;
&lt;MTSetVarBlock name="top_category_label2"&gt;&lt;MTTopLevelParent&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTTopLevelParent&gt;&lt;/MTSetVarBlock&gt;
&lt;/mt:IfArchiveType&gt;
&lt;mt:IfArchiveType archive_type="Category"&gt;
&lt;MTSetVarBlock name="category_label"&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTSetVarBlock&gt;
&lt;/mt:IfArchiveType&gt;</code></pre><p>先ほどのトップレベルカテゴリーのみの場合と違うのは、現在表示しているカテゴリーの親カテゴリーを変数として定義します。以下がソースです。</p><pre data-language=html><code>&lt;MTSetVarBlock name="top_category_label2"&gt;&lt;MTTopLevelParent&gt;&lt;$MTCategoryLabel$&gt;</code></pre><p>上記の部分で、親カテゴリーを定義しておきます。<br>これは、二階層目まで限定です。三階層目までいくと、ひとつ上のカテゴリではなく、一番上のカテゴリーを取得するので、分岐ができません。</p><p>次にカテゴリー一覧部分のソースです。</p><pre data-language=html><code>&lt;MTTopLevelCategories&gt;
&lt;MTSetVarBlock name="top_category_label2"&gt;&lt;MTTopLevelParent&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTTopLevelParent&gt;&lt;/MTSetVarBlock&gt;
&lt;MTSubCatIsFirst&gt;&lt;ul&lt;MTHasNoParentCategory&gt; id="localNavi"&lt;/MTHasNoParentCategory&gt;&gt;&lt;/MTSubCatIsFirst&gt;
&lt;MTIf name="top_category_label2" eq="$top_category_label"&gt;
&lt;li id="current"&gt;&lt;a href="&lt;$MTCategoryArchiveLink$&gt;"&gt;&lt;MTIfCategory&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTIfCategory&gt;&lt;/a&gt;
&lt;MTSubCategories&gt;
&lt;MTSetVarBlock name="category_label2"&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTSetVarBlock&gt;
&lt;MTSubCatIsFirst&gt;&lt;ul&gt;&lt;/MTSubCatIsFirst&gt;
&lt;MTIf name="category_label2" eq="$category_label"&gt;
&lt;li id="sub_current"&gt;&lt;a href="&lt;$MTCategoryArchiveLink$&gt;"&gt;&lt;MTIfCategory&gt;&lt;$MTCategoryLabel$&gt;&lt;/MTIfCategory&gt;&lt;/a&gt;&lt;/li&gt;
&lt;MTElse&gt;
&lt;li&gt;&lt;a href="&lt;$MTCategoryArchiveLink$&gt;"&gt;&lt;$MTCategoryLabel$&gt;&lt;/a&gt;&lt;MTSubCatsRecurse&gt;&lt;/li&gt;
&lt;/MTIf&gt;
&lt;MTSubCatIsLast&gt;&lt;/ul&gt;&lt;/MTSubCatIsLast&gt;
&lt;/MTSubCategories&gt;
&lt;/li&gt;
&lt;MTElse&gt;
&lt;li&gt;&lt;a href="&lt;$MTCategoryArchiveLink$&gt;"&gt;&lt;$MTCategoryLabel$&gt;&lt;/a&gt;&lt;MTSubCatsRecurse&gt;&lt;/li&gt;
&lt;/MTElse&gt;
&lt;/MTIf&gt;
&lt;MTSubCatIsLast&gt;&lt;/ul&gt;&lt;/MTSubCatIsLast&gt;
&lt;/MTTopLevelCategories&gt;</code></pre><p>上記のソースで構築すると以下のようなhtmlが吐き出されます。</p><pre data-language=html><code>&lt;ul id="localNavi"&gt;
&lt;li&gt;&lt;a href="#"&gt;親カテゴリー1&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li id="current"&gt;&lt;a href="#"&gt;所属している親カテゴリー2&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー1&lt;/a&gt;&lt;/li&gt;
&lt;li id="sub_current"&gt;&lt;a href="#"&gt;所属しているサブカテゴリー2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#"&gt;親カテゴリー3&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#"&gt;サブカテゴリー3&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</code></pre><p>これで、所属しているカテゴリーのみ別のスタイルを効かせることができるので、あとはCSSでハイライトさせる用のスタイルを書けばOKです。</p></div></article><div class=pager><a href=# class=pager__prev>&lt;&lt; Prev</a> <a href=# class=pager__next>Next &gt;&gt;</a></div><hr><section class=related-posts><h1>関連記事</h1><ul><li><a rel=bookmark href="/tools/2009/10/05/dreamweaver-apache/">DreamweaverとApacheを連携して、テスト環境の構築</a></li><li><a rel=bookmark href="/css/tools/2009/03/08/dw_codehint/">Dreamweaverのコードヒントでwidowsプロパティ等を出ないようにする。</a></li><li><a rel=bookmark href="/javascript/2008/10/19/rollover/">jQueryで画像置換</a></li><li><a rel=bookmark href="/2013/12/27/sass-bem/">SASSを使ってBEMで記述</a></li><li><a rel=bookmark href="/other/2008/10/16/post/">ブログ、ほぼ復活</a></li></ul></section></div><!-- / .main --><div class="footer-container container"><footer class=footer role=contentinfo><div class=social-rss><ul class=social-rss__list><li class=social-rss__item><a href=http://twitter.com/#!/howtohp id=twitter title=Twitter>Twitter</a></li><li class=social-rss__item><a href=http://www.facebook.com/howtohp id=facebook-page title="Facebook Page">Facebook Page</a></li><li class=social-rss__item><a href=http://feeds.feedburner.com/howtohp/ZiSA id=feed title=Feed>feed</a></li></ul></div><p><small class=copy>&#9786;&nbsp;howtohp</small> Powered by <a href="http://jekyllrb.com/">Jekyll</a></p></footer></div><!-- / #footer-container --><!-- build:js({app,.tmp}) /js/scripts.js --><script src=/js/main.js></script><!-- endbuild --></body></html>